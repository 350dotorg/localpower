{% extends "groups/base.html" %}
{% load record %}
{% load invites %}
{% load dated_static %}
{% load thumbnail %}

{% block title %}{{group.name}}{% endblock %}
{% block extralinks %}
    {% if group.slug %}
        <link rel="alternate" type="application/atom+xml"  href="{% url group_activity_feed group.slug %}" title="Repower at Home Team Activity" />
    {% endif %}
{% endblock %}
{% block breadcrumbs %}
<a href="{% url index %}">Home</a> &rsaquo;
<a href="{% url group_list %}">Teams</a> &rsaquo;
{{group.name}}
{% endblock %}
{% block right_content %}
<div class="grid_6 alpha">
    <div class="box_two_top"></div>
    <div class="box_two_middle">
        <h1>{{group.name}}</h1>
        <table class="tablesorter">
            <thead>
                <tr>
                    <th class="header">Members</th>
                    <th class="header">Committed Actions</th>
                    <th class="header">Actions Completed</th>
                    <th class="header">Points Earned</th>
                    <th class="header">Last Active</th>
                </tr>
            </thead>
            <tbody>
                {% for user in top_members %}
                    <tr>
                        <td>{% safe_user_link user %}</td>
                        <td>{{ user.actions_committed|default_if_none:0 }}</td>
                        <td>{{ user.actions_completed|default_if_none:0 }}</td>
                        <td>{{ user.total_points}}</td>
                        <td>{{ user.last_active|date }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="box_two_bottom"></div>
    
    <div class="box_two_top"></div>
    <div class="box_two_middle">
        {% if not group.is_geo_group %}
            <h2>Discussions</h2>
            <div class="group_disc_box_links">
                {% if is_poster %}
                    <a href="{% url group_disc_create group.slug %}">New discussion</a> 
                {% endif %}
                {% if is_poster and discs %}
                    |
                {% endif %}
                {% if discs %}
                    <a href="{% url group_disc_list group.slug %}">Archive</a>    
                {% endif %}
            </div>            
            {% if discs %}
                {% include "groups/_group_disc_list.html" %}
            {% else %}
                <em>No discussions yet.</em>
            {% endif %}
        {% endif %}
    </div>
    <div class="box_two_bottom"></div>
    
    {% if group_records %}
    <div class="box_two_top"></div>
    <div class="box_two_middle">
        <h2>Team Activity
            {% if group.slug %}
                <a class="atom_link" href="{% url group_activity_feed group.slug %}">
                    <img src="{% dated_static 'images/theme/rss.png' %}" alt="atom feed" />
                </a>
            {% endif %}
        </h2>
        {% for record in group_records %}
            {% render_record record %}
        {% endfor %}
    </div>
    <div class="box_two_bottom"></div>
    {% endif %}
</div>
<div class="grid_3 omega">
    <div class="box_one_top"></div>
    <div class="box_one_middle">
        <img src="{% thumbnail group.safe_image 189x157 crop='smart' %}" alt="group image" height="157" width="189" />
        <div>{{ group.description|linebreaks }}</div>
        <p>
            {% if is_manager %}
                <a href="{% url group_edit group.slug %}">Edit Team</a><br/>
            {% endif %}
            {% if group.is_joinable and is_member %}
                <a href="{% url group_leave group.id %}">Leave Team</a>
            {% endif %}
            {% if group.is_joinable and not is_member and not membership_pending %}
                <a class="button" href="{% url group_join group.id %}">Join Team</a>
            {% endif %}
            {% if membership_pending %}
                <p>Your membership status is currently <b>pending</b>.</p>
            {% endif %}
        </p>
    </div>
    <div class="box_one_bottom"></div>
    
    {% if requesters %}
    <div class="box_one_top"></div>
    <div class="box_one_middle">
        <h3>Membership Requests</h3>
        <ul>
            {% for requester in requesters %}
                <li class="membership_request">
                    {% safe_user_link requester %} would like to join
                    <div class="membership_tools">
                        <a href="{% url group_approve group.id requester.id %}">Approve</a> or 
                        <a href="{% url group_deny group.id requester.id %}">Deny</a>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="box_one_bottom"></div>
    {% endif %}
    
    {% if is_member %}
    <div class="box_one_top"></div>
    <div class="box_one_middle">
        <h3>Magnify your Impact</h3>
        <p>
            <a href='{% url invite-invite %}' class='invite_friend_link'>Invite a friend to this team</a>
        </p>
        <div id='invite_friend_dialog'>
            {% get_invite_form for group %}
        </div>
    </div>
    <div class="box_one_bottom"></div>
    {% endif %}
    
    {% if popular_actions %}
    <div class="box_one_top"></div>
    <div class="box_one_middle">
        <h3>Popular Actions</h3>
        {% for action in popular_actions %}
        <p>
            <a href="{% url action_detail action.slug %}">{{ action }}</a><br/>
            <span class="smaller">{{ action.completes_in_group }} member{{ action.completes_in_group|pluralize }}</span>
        </p>
        {% endfor %}
    </div>
    <div class="box_one_bottom"></div>
    {% endif %}
</div>
{% endblock %}

{% block js %}page_group_detail{% endblock %}