require 'codebase/recipes'

ssh_options[:keys] = %w(~/.ec2/acp-ec2-pk.pem)  

set :deploy_to, "/scripts/www"
set :application, "rah"
set :user, "ubuntu"

# These things are not used at the moment
set :scm, :git
set :repository, "git@codebasehq-deploy:rah/rah/rah.git"

role :app, "repowerathome.com"
# role :web, "repowerathome.com"
# role :db, "repowerathome.com", :primary => true

namespace :deploy do
    desc "Meta task that calls update and restart"
    task :default do
        update
        syncdb
        restart
    end
    
    desc "Update Repo"
    task :update, :roles => :app do
        run "cd #{deploy_to}; git pull"
    end
    
    desc "Sync DB"
    task :syncdb, :roles => :app do
        run "cd /scripts/www/; python manage.py syncdb"
    end
    
    desc "Restart Apache"
    task :restart, :roles => :app do
        sudo "/etc/init.d/apache2 restart"
    end
end