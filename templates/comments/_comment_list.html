{% load comments %}
{% load ratings %}

{% get_comment_list for object as comments %}
{% if comments %}
	<h2>Comments</h2>
	{% for comment in comments %}
		<div class="comment">
			{{ comment.comment|safe|linebreaks }}
			<p class="author">
				{% if comment.user != user and comment.user.get_profile.is_profile_private %}
					-- Posted by {{ comment.user.get_full_name }} on {{ comment.submit_date|date:"F j, Y" }}
				{% else %}
					-- Posted by <a href="{% url profile comment.user.id %}">{{ comment.user.get_full_name }}</a> on {{ comment.submit_date|date:"F j, Y" }}
				{% endif %}
			</p>
			<div>
			    {% get_rating_count for comment as users_voted %}
			    {% get_rating_sum for comment as users_helped %}
			    {% if users_voted %}
			        {{ users_helped }} out of {{ users_voted }} user{{ users_voted|pluralize }} found this helpful.<br />
			    {% endif %}
			    {% if user.is_authenticated %}
        		    <span class="comment_helpful_question">Did you find this comment helpful?</span>
        			{% get_rating_form for comment %}
        		{% endif %}
			</div>
		</div>
	{% endfor %}
{% endif %}
{% include 'comments/_comment_form.html' %}