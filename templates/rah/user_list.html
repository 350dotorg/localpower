{% extends "base/nav_9c.html" %}
{% load i18n %}
{% load dated_static %}
{% block title %}{% blocktrans %}User List{% endblocktrans %}{% endblock %}
{% block title_bar_title %}{% blocktrans %}User List{% endblocktrans %}{% endblock %}
{% block title_bar_copy %}
{% blocktrans %}
Browse users
{% endblocktrans %}
{% endblock %}
{% block ribbon_bar %}
{% blocktrans with users|length as num_users %}
Showing {{num_users}} users
{% endblocktrans %}
{% endblock %}
{% block content %}
<div id="map_search" style="padding: 5px; background-color: #f2f2f2; 
			    border-radius: 5px;">
  <form class="search_widget">
    <div>
      <div style="float: right; padding-bottom: 5px; padding-left: 10px;">
	<input type="text" placeholder="{% blocktrans %}Address or region{% endblocktrans %}" 
	       id="search_widget_input" style="width: 250px"
	       class="search_value ui-autocomplete-input" role="textbox" />
	<button class="search_button"><span class="sprite_search_mag"></button>
      </div>
      <label style="float:right; padding-top: 5px"
	     for="map_search_place">{% blocktrans %}Search near:{% endblocktrans %}</label>
    </div>
  </form>
</div>
<div id="events_map_container">
    <div id="events_map"></div>
    <div id="events_map_shadow_top"></div>
    <div id="events_map_shadow_right"></div>
    <div id="events_map_shadow_bottom"></div>
    <div id="events_map_shadow_left"></div>
</div>

<ul class="plain_list nugget_9c_list">
  {% for user in users %}
  {% with user.get_profile as profile %}
  <li>
    <a href="{{user.get_absolute_url}}">
      <img src="{% url user_profile_picture user.id %}" 
	   alt="{% blocktrans %}Profile image{% endblocktrans %}"
	   height="38" width="45" />
    </a>
    <div>
      <a href="{{user.get_absolute_url}}">
	{{user.get_full_name}}
      </a>
      {% if profile.geom %}
      <div class="smaller">
	{{ profile.geom }}
      </div>
      {% endif %}
      {% if profile.about %}
      <div class="smaller">
	{{profile.about}}
      </div>
      {% endif %}
    </div>
  </li>
  {% endwith %}
  {% endfor %}
</ul>

<script type="text/javascript" charset="utf-8">
    //<![CDATA[
    var RAH = RAH || {};
    RAH.pagescripts = RAH.pagescripts || [];
    RAH.pagescripts.push("{% dated_static 'js/pages/user.list.js' %}");
    RAH.sprite_url = "{% dated_static 'images/theme/sprite.png' %}";
    // Add locations for plotting on the map
    RAH.event_locations = [];
    RAH.map_center = {};
    {% with request.user.get_profile.geom as geom %}
    {% if geom %}
    RAH.map_center.lat = {{geom.latlng.y}};
    RAH.map_center.lng = {{geom.latlng.x}};
    {% endif %}
    {% endwith %}
    {% for user in map_users %}
        {% with user.get_profile.geom as geom %}
        var info = "<b>{{ user.get_full_name|escape|escapejs }}</b><br/> {{ geom|escape|escapejs }}<br/>";
            info += "<a href='{% url profile user.id %}'>{% blocktrans %}View profile{% endblocktrans %}</a>";
        RAH.event_locations.push({
            lat: "{{ geom.latlng.y }}",
            lon: "{{ geom.latlng.x }}",
            "info": info
        });
        {% endwith %}
    {% endfor %}
    //]]>
</script>
{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
{% endblock %}

