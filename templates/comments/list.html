{% load comments %}
{% load ratings %}
{% load flags %}

{% get_comment_list for object as comments %}
{% if comments %}
    <h2 id="comments_heading">What people are saying</h2>
    {% for comment in comments %}
        <div class="container_3">
            <div class="grid_2 alpha comment_wrapper">
                <div class="comment">
                    {{ comment.comment|linebreaksbr }}
                </div>
                <span class="point"></span>
                <div class="comment_tools">
                    <span class="comment_date">
                        {{ comment.submit_date|date:"DATETIME_FORMAT" }}
                    </span>
                    <div class="comment_buttons">
                        {% get_rating_count for comment as users_voted %}
                        {% get_rating_sum for comment as users_helped %}
                        {% if users_voted %}
                            {{ users_helped }} of {{ users_voted }} liked this
                        {% endif %}
                        {% if user.is_authenticated %}
                            {% get_rating_form for comment %}
                            {% get_flag_form for comment %}
                        {% endif %}                    
                    </div>
                </div>
            </div>
            <div class="grid_1 omega">
                <div class="comment_author">
                    <img class="gravatar" src="{{ comment.user.get_profile.get_gravatar_url }}" alt="user gravatar" />
                    <br class="clear" />
                    {% safe_user_link comment.user %}
                </div>
            </div>
        </div>
        <br class="clear" />
    {% endfor %}
{% endif %}